<!doctype html> 
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Gym Progress ‚Äî offline</title>
  <style>
    :root{
      --bg:#ffffff; --fg:#0f172a; --muted:#64748b; --line:#e2e8f0;
      --card:#f8fafc; --card2:#f1f5f9;
      --accent:#2563eb; --danger:#dc2626;
      --shadow: 0 10px 30px rgba(2,6,23,.08);
      --stickyBg: rgba(255,255,255,.92);
      --gold:#f59e0b;     /* —Ä–µ–∫–æ—Ä–¥ */
      --green:#22c55e;    /* –Ω–æ–≤—ã–π –≤–µ—Å */
      --yellow:#eab308;   /* –Ω–æ–≤–æ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ */
      --grayFill:#f1f5f9; /* –Ω–µ —Ä–µ–∫–æ—Ä–¥ */
      --injuryFill:#ffe4f1; /* —Ç—Ä–∞–≤–º–∞ (—Ä–æ–∑–æ–≤—ã–π) */
      --radius:16px;
      --rowH: 44px;
      --leftW: 132px;
    }
    [data-theme="dark"]{
      --bg:#0b1220; --fg:#e5e7eb; --muted:#9aa7bd; --line:#1f2a44;
      --card:#0f172a; --card2:#111c33;
      --accent:#60a5fa; --danger:#f87171;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --stickyBg: rgba(11,18,32,.88);
      --grayFill:#101a31;
      --injuryFill:#3a1530;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font: 14px/1.35 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--bg); color:var(--fg);
      -webkit-font-smoothing: antialiased; text-rendering: optimizeLegibility;
    }
    button,input,select{font:inherit}
    .app{min-height:100%;display:flex;flex-direction:column;}
    .topbar{
      position:sticky; top:0; z-index:50;
      backdrop-filter: blur(10px);
      background: var(--stickyBg);
      border-bottom:1px solid var(--line);
      padding: 10px 12px calc(10px + env(safe-area-inset-top));
    }
    .topbar .row{display:flex;align-items:center;gap:10px;}
    .brand{display:flex;flex-direction:column;gap:2px;min-width:0;}
    .brand b{font-weight:800;letter-spacing:.2px}
    .brand small{color:var(--muted)}
    .spacer{flex:1}
    .btn{
      border:1px solid var(--line);
      background: var(--card);
      color: var(--fg);
      border-radius: 12px;
      padding: 10px 12px;
      display:inline-flex; align-items:center; gap:8px;
      cursor:pointer;
      touch-action: manipulation;
    }
    .btn:active{transform: translateY(1px)}
    .btn.primary{border-color:transparent;background:var(--accent);color:white;}
    .btn.icon{width:42px;justify-content:center;padding:10px;}
    .seg{
      display:flex;gap:6px;padding:6px;
      border:1px solid var(--line);
      border-radius:14px;
      background:var(--card);
    }
    .seg button{
      border:0;background:transparent;color:var(--muted);
      padding:8px 10px;border-radius:10px;cursor:pointer;
    }
    .seg button.active{background:var(--card2);color:var(--fg);font-weight:700;}
    .content{flex:1;display:flex;flex-direction:column;min-height:0}
    .view{flex:1;min-height:0;display:none}
    .view.active{display:flex;flex-direction:column;min-height:0}
    .tableWrap{
      flex:1;min-height:0;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
      padding:10px 0;
    }
    table{
      border-collapse: separate;
      border-spacing:0;
      width:max-content;
      min-width:100%;
      position:relative;
    }
    th,td{
      border-bottom:1px solid var(--line);
      border-right:1px solid var(--line);
      height:var(--rowH);
      padding:6px 8px;
      vertical-align:middle;
      background:var(--bg);
      white-space:nowrap;
    }
    thead{
      position:sticky;
      top:0;
      z-index:15;
      background:var(--stickyBg);
      backdrop-filter: blur(10px);
    }
    thead tr{background:var(--stickyBg);}
    thead th{
      position:sticky;
      top:0;
      z-index:16;
      background:var(--stickyBg);
      backdrop-filter: blur(10px);
      font-weight:800;
    }
    th:first-child, td:first-child{border-left:1px solid var(--line);}
    tr:first-child th{border-top:1px solid var(--line);}
    .stickyLeft{
      position:sticky;left:0;z-index:8;
      background:var(--stickyBg);
      backdrop-filter: blur(10px);
      width:var(--leftW);
      min-width:var(--leftW);
      max-width:var(--leftW);
      border-right:1px solid var(--line);
    }
    th.stickyLeft{z-index:18}
    .corner{z-index:25 !important;}
    .leftCell{display:flex;align-items:center;gap:8px;min-width:0;}
    .leftText{min-width:0;overflow:hidden;text-overflow:ellipsis;}
    .blockRow .leftText{text-transform:uppercase;font-weight:900;letter-spacing:.8px;}
    .exRow .leftText{font-weight:800;text-transform:lowercase;padding-left:10px;}
    .wRow .leftText{font-weight:500;text-transform:lowercase;padding-left:22px;color:var(--muted);}
    .wRow .sideTag{
      font-size:11px;padding:2px 6px;border-radius:999px;
      border:1px solid var(--line);color:var(--muted);
      background:var(--card);flex:0 0 auto;
    }
    .exRow td{height:auto;white-space:normal;}
    .exRow .stickyLeft{white-space:normal;}
    .exRow .leftText{
      white-space:normal;overflow:visible;text-overflow:clip;word-break:break-word;
    }
    .wRow td{height:auto;white-space:normal;}
    .wRow .stickyLeft{white-space:normal;}
    .wRow .leftText{
      white-space:normal;overflow:visible;text-overflow:clip;word-break:break-word;
    }
    .tinyIcon{
      border:0;background:transparent;color:var(--muted);
      padding:6px;margin:-6px;cursor:pointer;
    }
    .tinyIcon:active{transform: translateY(1px)}
    .pill{
      display:inline-flex;align-items:center;gap:6px;
      padding:4px 8px;border-radius:999px;
      border:1px solid var(--line);background:var(--card);
      color:var(--muted);font-size:12px;
    }
    td.cell{
      position:relative;
      cursor:pointer;
      background:var(--bg);
      min-width:96px;
      max-width:120px;
    }
    td.cell .val{
      font-weight:800;
      font-size:13px;
      line-height:1.1;
    }
    td.cell .sub{
      font-size:11px;color:var(--muted);
      margin-top:2px;
      overflow:hidden;text-overflow:ellipsis;
    }
    td.cell.empty .val{color:var(--muted);font-weight:400}
    td.cell:not(.empty) .sub{color:var(--fg);font-weight:800}
    td.cell.empty .sub{display:none}
    td.cell.gray{background:var(--grayFill);}
    td.cell.injury{background:var(--injuryFill);}
    td.cell.border-gold{box-shadow: inset 0 0 0 2px var(--gold);}
    td.cell.border-green{box-shadow: inset 0 0 0 2px var(--green);}
    td.cell.border-yellow{box-shadow: inset 0 0 0 2px var(--yellow);}
    
    /* –ò–ó–ú–ï–ù–ï–ù–û: —Å—Ç–∏–ª—å –¥–ª—è –∑–æ–ª–æ—Ç–æ–π –∑–≤–µ–∑–¥—ã */
    .star-icon {
        color: var(--gold);
        margin-left: 4px;
        font-weight: bold;
        display: inline-block;
        filter: drop-shadow(0 0 1px rgba(0,0,0,0.2));
    }

    .dateHead{display:flex;align-items:center;justify-content:space-between;gap:8px;}
    .dateHead .d{font-weight:900}
    .dateHead .trash{
      border:0;background:transparent;color:var(--muted);
      cursor:pointer;padding:6px;margin:-6px;border-radius:10px;
    }
    .dateHead .trash:active{transform: translateY(1px)}
    .hintRow{
      padding:0 12px 12px;
      display:flex;align-items:center;gap:8px;flex-wrap:wrap;
      color:var(--muted);
    }
    .overlay{position:fixed;inset:0;background:rgba(2,6,23,.35);display:none;z-index:100;}
    .overlay.show{display:block}
    .drawer{
      position:fixed;top:0;right:0;bottom:0;
      width:min(92vw,420px);
      background:var(--bg);
      border-left:1px solid var(--line);
      box-shadow: var(--shadow);
      transform: translateX(100%);
      transition: transform .18s ease;
      z-index:110;
      display:flex;flex-direction:column;
      padding:12px 12px calc(12px + env(safe-area-inset-bottom));
    }
    .drawer.show{transform: translateX(0)}
    .drawer header{
      display:flex;align-items:center;gap:10px;
      padding:6px 2px 10px;border-bottom:1px solid var(--line);
    }
    .drawer header b{font-size:16px}
    .drawer .body{flex:1;overflow:auto;padding-top:10px}
    .section{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:10px;
      margin-bottom:10px;
    }
    .section h3{
      margin:0 0 8px 0;
      font-size:13px;
      text-transform:uppercase;
      letter-spacing:.8px;
      color:var(--muted);
    }
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .field{display:flex;flex-direction:column;gap:6px;margin-bottom:8px}
    .field label{font-size:12px;color:var(--muted)}
    input[type="text"], input[type="number"], select{
      border:1px solid var(--line);
      background:var(--bg);
      color:var(--fg);
      border-radius:12px;
      padding:10px 10px;
      outline:none;
    }
    .rowActions{display:flex;gap:8px;flex-wrap:wrap}
    .danger{border-color:rgba(220,38,38,.35);color:var(--danger);background:transparent}
    .modalOverlay{
      position:fixed;inset:0;background:rgba(2,6,23,.38);
      display:none;z-index:200;padding:12px;
    }
    .modalOverlay.show{display:flex;align-items:center;justify-content:center}
    .modal{
      width:min(96vw,520px);
      background:var(--bg);
      border:1px solid var(--line);
      border-radius:18px;
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .modal header{
      padding:12px;border-bottom:1px solid var(--line);
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      background:var(--card);
    }
    .modal header b{font-size:14px}
    .modal main{padding:12px}
    .modal footer{
      padding:12px;border-top:1px solid var(--line);
      display:flex;gap:8px;justify-content:flex-end;
      background:var(--card);
    }
    .sets{display:flex;flex-direction:column;gap:8px;margin:8px 0 10px;}
    .setRow{display:flex;gap:8px;align-items:center;}
    .setRow input{flex:1}
    .setRow button{width:42px;}
    .toggleLine{
      display:flex;align-items:center;justify-content:space-between;
      padding:10px;border:1px solid var(--line);
      border-radius:14px;background:var(--card);
      margin-top:8px;
    }
    .toggleLine .left{display:flex;align-items:center;gap:10px}
    .badge{
      font-size:12px;padding:4px 8px;border-radius:999px;
      border:1px solid var(--line);background:var(--bg);color:var(--muted);
    }
    .analyticsWrap{padding:12px;display:flex;flex-direction:column;gap:10px;min-height:0;}
    .panel{border:1px solid var(--line);border-radius:var(--radius);background:var(--card);padding:10px;}
    .panel h3{margin:0 0 8px 0;font-size:13px;text-transform:uppercase;letter-spacing:.8px;color:var(--muted);}
    canvas{width:100%;height:180px;background:var(--bg);border:1px solid var(--line);border-radius:14px;display:block;}
    .insights{display:flex;flex-direction:column;gap:8px;color:var(--fg);}
    .insights .muted{color:var(--muted);font-size:12px}
    .kpiRow{display:flex;gap:8px;flex-wrap:wrap}
    .kpi{
      flex:1;min-width:130px;border:1px solid var(--line);
      border-radius:14px;background:var(--bg);padding:10px;
    }
    .kpi b{display:block;font-size:16px}
    .kpi small{color:var(--muted)}
    .legendLine{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .dot{width:10px;height:10px;border-radius:3px;border:2px solid transparent;display:inline-block}
    .dot.gold{border-color:var(--gold)}
    .dot.green{border-color:var(--green)}
    .dot.yellow{border-color:var(--yellow)}
    .dot.gray{background:var(--grayFill);border-color:var(--line)}
    .dot.pink{background:var(--injuryFill);border-color:var(--line)}
    @media (max-width: 380px){
      :root{ --leftW: 120px; --rowH: 42px; }
    }
  </style>
</head>
<body>
<div class="app" id="app">
  <div class="topbar">
    <div class="row">
      <button class="btn icon" id="btnMenu" aria-label="–ú–µ–Ω—é"> ‚ò∞ </button>
      <div class="brand">
        <b>Gym Progress</b>
        <small id="subTitle">offline ‚Ä¢ —Ç–∞–±–ª–∏—Ü–∞</small>
      </div>
      <div class="spacer"></div>
      <div class="seg" role="tablist" aria-label="–≠–∫—Ä–∞–Ω—ã">
        <button id="tabTable" class="active" role="tab" aria-selected="true">–¢–∞–±–ª–∏—Ü–∞</button>
        <button id="tabAnalytics" role="tab" aria-selected="false">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</button>
      </div>
      <button class="btn primary" id="btnAddWorkout">+ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</button>
      <button class="btn icon" id="btnHelp" aria-label="–õ–µ–≥–µ–Ω–¥–∞">?</button>
    </div>
  </div>
  <div class="content">
    <div class="hintRow" id="hintRow">
      <span class="pill">–¢–∞–ø –ø–æ —è—á–µ–π–∫–µ ‚Üí —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</span>
      <span class="pill">Long-press –ø–æ –¥–∞—Ç–µ (~0.7s) ‚Üí —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
    </div>
    <section class="view active" id="viewTable" aria-label="–¢–∞–±–ª–∏—Ü–∞">
      <div class="tableWrap" id="tableWrap"></div>
    </section>
    <section class="view" id="viewAnalytics" aria-label="–ê–Ω–∞–ª–∏—Ç–∏–∫–∞">
      <div class="analyticsWrap">
        </div>
    </section>
  </div>
</div>
<div class="overlay" id="overlay"></div>
<aside class="drawer" id="drawer" aria-label="–ú–µ–Ω—é">
    </aside>

<div class="modalOverlay" id="cellModalOverlay" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-label="–†–µ–¥–∞–∫—Ç–æ—Ä">
    <header>
      <div>
        <b id="cellTitle">–Ø—á–µ–π–∫–∞</b><br/>
        <small id="cellSubtitle" style="color:var(--muted)"></small>
      </div>
      <button class="btn icon" id="btnCloseCellModal" aria-label="–ó–∞–∫—Ä—ã—Ç—å"> ‚úï </button>
    </header>
    <main>
      <div class="sets" id="setsWrap"></div>
      <div class="rowActions">
        <button class="btn" id="btnAddSet">+ —Å–µ—Ç</button>
        <button class="btn" id="btnClearSets">–û—á–∏—Å—Ç–∏—Ç—å</button>
      </div>
      
      <div class="toggleLine">
        <div class="left">
          <span class="badge"> ‚≠ê </span>
          <div>
            <b style="display:block">–ó–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞–Ω–æ</b>
            <small style="color:var(--muted)">–ó–æ–ª–æ—Ç–∞—è –∑–≤–µ–∑–¥–æ—á–∫–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ</small>
          </div>
        </div>
        <button class="btn" id="btnToggleStarred">–í—ã–∫–ª</button>
      </div>

      <div class="toggleLine">
        <div class="left">
          <span class="badge"> ü©π </span>
          <div>
            <b style="display:block">–¢—Ä–∞–≤–º–∞</b>
            <small style="color:var(--muted)">–†–æ–∑–æ–≤—ã–π —Ñ–æ–Ω</small>
          </div>
        </div>
        <button class="btn" id="btnToggleInjury">–í—ã–∫–ª</button>
      </div>
    </main>
    <footer>
      <button class="btn" id="btnCancelCell">–û—Ç–º–µ–Ω–∞</button>
      <button class="btn primary" id="btnSaveCell">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </footer>
  </div>
</div>

<div class="modalOverlay" id="infoModalOverlay" aria-hidden="true">
    </div>

<script>
/* =========================== –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã + —É—Ç–∏–ª–∏—Ç—ã =========================== */
const LS_KEY = "gymProgress.v1";
const DEFAULT_BLOCKS = ["–ì–†–£–î–¨","–ë–ò–¶–ï–ü–°","–°–ü–ò–ù–ê","–î–ï–õ–¨–¢–´","–ù–û–ì–ò"];
const STATUS = { RECORD: "record", NEW_WEIGHT: "new_weight", NEW_EX: "new_ex", NOT_RECORD: "not_record" };
const nowId = () => Math.random().toString(16).slice(2) + Date.now().toString(16);
const clampInt = (v) => { const n = parseInt(String(v||"").trim(), 10); return Number.isFinite(n) && n>=0 ? n : null; };
function parseDDMMYYYY(s){ if(!s) return null; const m = String(s).trim().match(/^(\d{2})\.(\d{2})\.(\d{4})$/); if(!m) return null; const dd = +m[1], mm = +m[2], yyyy = +m[3]; const d = new Date(yyyy, mm-1, dd); return d; }
function fmtDate(d){ const dd = String(d.getDate()).padStart(2,"0"); const mm = String(d.getMonth()+1).padStart(2,"0"); const yy = d.getFullYear(); return `${dd}.${mm}.${yy}`; }
function sortWorkoutsAsc(workouts){ return [...workouts].sort((a,b)=>{ const da = parseDDMMYYYY(a.date), db = parseDDMMYYYY(b.date); return (da?da.getTime():0) - (db?db.getTime():0); }); }
function weightMaxNumber(label){ const s = String(label||"").trim(); const nums = s.match(/(\d+(?:[.,]\d+)?)/g); if(!nums) return Number.POSITIVE_INFINITY; let max = -Infinity; for(const t of nums){ const n = parseFloat(t.replace(",",".")); if(Number.isFinite(n)) max = Math.max(max,n); } return Number.isFinite(max) ? max : Number.POSITIVE_INFINITY; }
function weightStepsFromLabel(weightLabel){ const s = String(weightLabel||"").trim(); if(!s.includes("-")) return 1; const parts = s.split("-").map(x=>x.trim()).filter(Boolean); return parts.length >= 2 ? parts.length : 1; }
function parseRepsValue(raw, steps){ const s = String(raw ?? "").trim(); if(!s) return null; if(steps<=1) return clampInt(s); const parts = s.split("-").map(x=>x.trim()).filter(x=>x.length>0); if(parts.length !== steps) return null; const nums = parts.map(clampInt); if(nums.some(n=>n==null)) return null; return nums.join("-"); }
function repsMeta(val, steps){ if(steps<=1){ const n = (typeof val === "number") ? val : clampInt(val); return n==null ? null : {parts:[n], prefixKey:"", last:n, str:String(n)}; } if(typeof val !== "string") return null; const parts = val.split("-").map(x=>clampInt(x.trim())); if(parts.length !== steps || parts.some(n=>n==null)) return null; return {parts, prefixKey:parts.slice(0,-1).join("-"), last:parts[parts.length-1], str: parts.join("-")}; }

/* =========================== –ú–æ–¥–µ–ª—å –∏ —Ä–µ–Ω–¥–µ—Ä =========================== */
let state = loadState();
const $ = (s, r=document) => r.querySelector(s);
const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));

function loadState(){ 
  try{ 
    const raw = localStorage.getItem(LS_KEY); 
    if(!raw) return seedState(); 
    return JSON.parse(raw); 
  }catch(e){ return seedState(); } 
}
function saveState(){ localStorage.setItem(LS_KEY, JSON.stringify(state)); }
function seedState(){ return { theme: "light", blocks: [], workouts: [], entries: {} }; } // –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Å–∏–¥

function renderTable(){
  const tableWrap = $("#tableWrap");
  if(!tableWrap) return;
  const workouts = sortWorkoutsAsc(state.workouts);
  const lastWorkoutId = workouts.length ? workouts[workouts.length-1].id : null;

  let html = `<table><thead><tr><th class="stickyLeft corner">–£–ø—Ä / –î–∞—Ç–∞</th>`;
  workouts.forEach(w => { html += `<th>${w.date}</th>`; });
  html += `</tr></thead><tbody>`;

  state.blocks.forEach(b => {
    html += `<tr class="blockRow"><td class="stickyLeft"><div class="leftText">${b.name}</div></td><td colspan="${workouts.length}"></td></tr>`;
    b.exercises.filter(e => !e.archived).forEach(e => {
      html += `<tr class="exRow"><td class="stickyLeft"><div class="leftText">${e.name}</div></td><td colspan="${workouts.length}"></td></tr>`;
      e.weights.filter(w => !w.hidden).forEach(w => {
        html += `<tr class="wRow"><td class="stickyLeft"><div class="leftText">${w.label}</div></td>`;
        workouts.forEach(work => {
          const entry = getCellEntry(work.id, e.id, w.id);
          const isEmpty = !entry || (!entry.sets?.length && !entry.L?.sets?.length);
          let valText = "";
          let subText = "";
          
          /* –ò–ó–ú–ï–ù–ï–ù–û: –õ–æ–≥–∏–∫–∞ –∑–æ–ª–æ—Ç–æ–π –∑–≤–µ–∑–¥–æ—á–∫–∏ –≤ —Ç–µ–∫—Å—Ç–µ */
          const starIcon = (entry && entry.starred) ? `<span class="star-icon">‚≠ê</span>` : "";

          if(isEmpty){
            if(work.id === lastWorkoutId){
                valText = "–Ω–∞–¥–æ..."; // –ó–¥–µ—Å—å –≤–∞—à–∞ –ª–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —Ü–µ–ª–∏ "–Ω–∞–¥–æ"
            }
          } else {
            valText = "–≤—ã–ø..."; // –ó–¥–µ—Å—å –ª–æ–≥–∏–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–µ—Ç–æ–≤
          }

          html += `<td class="cell ${isEmpty?'empty':''}" onclick="openCellModal('${work.id}','${e.id}','${w.id}')">
            <div class="val">${valText}${starIcon}</div>
            <div class="sub">${subText}</div>
          </td>`;
        });
        html += `</tr>`;
      });
    });
  });
  html += `</tbody></table>`;
  tableWrap.innerHTML = html;
}

/* =========================== –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ =========================== */
let curCell = null; // {wId, exId, weightId, entry}

function openCellModal(wId, exId, weightId){
    curCell = { wId, exId, weightId, entry: JSON.parse(JSON.stringify(getCellEntry(wId, exId, weightId) || {sets:[], starred:false, injury:false})) };
    $("#cellModalOverlay").classList.add("show");
    renderCellModal();
}

function renderCellModal(){
    const btnStarred = $("#btnToggleStarred");
    btnStarred.textContent = curCell.entry.starred ? "–í–∫–ª" : "–í—ã–∫–ª";
    btnStarred.style.color = curCell.entry.starred ? "var(--gold)" : "";
    
    // –ò–º–µ–Ω–∞ –∏ –¥—Ä—É–≥–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã...
}

$("#btnToggleStarred").addEventListener("click", () => {
    curCell.entry.starred = !curCell.entry.starred;
    renderCellModal();
});

$("#btnSaveCell").addEventListener("click", () => {
    setCellEntry(curCell.wId, curCell.exId, curCell.weightId, curCell.entry);
    saveState();
    renderTable();
    $("#cellModalOverlay").classList.remove("show");
});

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏...
function getCellEntry(workoutId, exId, wId){ return (state.entries[workoutId]?.[exId]?.[wId]) || null; }
function setCellEntry(workoutId, exId, wId, entry){
    if(!state.entries[workoutId]) state.entries[workoutId] = {};
    if(!state.entries[workoutId][exId]) state.entries[workoutId][exId] = {};
    state.entries[workoutId][exId][wId] = entry;
}

$("#btnCloseCellModal").onclick = () => $("#cellModalOverlay").classList.remove("show");
$("#btnCancelCell").onclick = () => $("#cellModalOverlay").classList.remove("show");

// –ü–µ—Ä–≤–∏—á–Ω—ã–π –∑–∞–ø—É—Å–∫
window.onload = renderTable;
</script>
</body>
</html>
